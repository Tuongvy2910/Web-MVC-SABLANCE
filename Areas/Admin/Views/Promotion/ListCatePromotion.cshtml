@model IPagedList<SABLANCE.Models.CategoriesPromotion>

@{
    ViewBag.Title = "Danh mục Chương trình khuyến mãi ";
    Layout = "~/Areas/Admin/Views/Shared/_Admin.cshtml";
}
@using PagedList.Mvc;
@using PagedList;
<link href="~/Content/productadmin.css" rel="stylesheet" />


<div class="list-add">
    <div>
        <h2>DANH MỤC CHƯƠNG TRÌNH KHUYẾN MÃI</h2>
    </div>
    <button class="Btn" id="addCateProBtn" data-toggle="modal" data-target="#addCatePromotionModal">

        <div class="sign">
            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="50" height="50" viewBox="0 0 72 72">
                <path d="M36,12c13.255,0,24,10.745,24,24c0,13.255-10.745,24-24,24S12,49.255,12,36C12,22.745,22.745,12,36,12z M44,39	c1.657,0,3-1.343,3-3c0-1.657-1.343-3-3-3c-0.329,0-2.426,0-5,0c0-2.574,0-4.672,0-5c0-1.657-1.343-3-3-3c-1.657,0-3,1.343-3,3	c0,0.328,0,2.426,0,5c-2.574,0-4.671,0-5,0c-1.657,0-3,1.343-3,3c0,1.657,1.343,3,3,3c0.329,0,2.426,0,5,0c0,2.574,0,4.672,0,5	c0,1.657,1.343,3,3,3c1.657,0,3-1.343,3-3c0-0.328,0-2.426,0-5C41.574,39,43.671,39,44,39z"></path>
            </svg>
        </div>
        <div class="text">Thêm danh mục</div>
    </button>
</div>
<div class="modal" id="successModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <img src="~/Image/logo_sab.png" class="modal-title" style="width: 30%;" />
            </div>
            <div class="modal-body">
                <p style="font-weight: bold; font-size: 20px;">Xóa danh mục chương trình khuyến mãi thành công.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="questionModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <img src="~/Image/logo_sab.png" class="modal-title" style="width: 30%;" />
            </div>
            <div class="modal-body">
                <p style="font-weight: bold; font-size: 20px;">Bạn có chắc muốn xóa danh mục chương trình khuyến mãi này ? </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Không</button>
                <button type="button" class="btn btn-primary" id="confirmDelete">Có</button>
            </div>
        </div>
    </div>
</div>
<!--Thêm chương trình khuyến mãi-->
<div class="modal fade bd-example-modal-lg" id="addPromotionModal" tabindex="-1" role="dialog" aria-labelledby="addPromotionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="CreatePromotionViewModalLabel" style="font-weight: bold; font-size: 20px;">THÊM CHƯƠNG TRÌNH KHUYẾN MÃI</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="CreatePromotionViewModalContent">

            </div>
        </div>
    </div>
</div>
<!-- Modal thêm danh mục CTKM -->
<div class="modal fade bd-example-modal-lg" id="addCatePromotionModal" tabindex="-1" role="dialog" aria-labelledby="addCatePromotionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="CreateCatePromotionViewModalLabel" style="font-weight: bold; font-size: 20px;">THÊM DANH MỤC CHƯƠNG TRÌNH KHUYẾN MÃI</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="CreateCatePromotionViewModalContent">

            </div>
        </div>
    </div>
</div>


<!-- Modal chỉnh sửa danh mục CTKM -->
<div class="modal fade bd-example-modal-lg" id="editCatePromotionModal" tabindex="-1" role="dialog" aria-labelledby="editCatePromotionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="EditViewModalLabel" style="font-weight: bold; font-size: 20px;">Chỉnh sửa Thông tin Sản phẩm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="EditViewModalContent">

            </div>
        </div>
    </div>
</div>

@*Modal chi tiết danh mục CTKM*@


<div class="modal fade bd-example-modal-lg" id="catepromotionDetailModal" tabindex="-1" role="dialog" aria-labelledby="catepromotionDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="catepromotionDetailModalLabel" style="font-weight: bold; font-size: 18px;">Thông Tin Chi Tiết Sản Phẩm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="catepromotionDetailContent">

            </div>
        </div>
    </div>
</div>
<table id="employee-table" class="table table-bordered table-responsives table-striped">

    <thead>
        <tr style="text-align: center;">
            <th>
                ID
            </th>
            <th>
                Mã danh mục
            </th>
            <th>
                Tên danh mục
            </th>
            <th>
                Số lượng chương trình
            </th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    @if (Model != null && Model.Count() > 0)
    {
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @item.ID.ToString("0")
                    </td>
                    <td onclick="showCatePromotionDetail(@item.ID)" class="hover-emdetail">
                        <a data-toggle="modal" data-target="#catepromotionDetailModal" data-id="@item.ID"> @item.Code</a>

                    </td>
                    <td onclick="showCatePromotionDetail(@item.ID)" class="hover-emdetail">
                        <a data-toggle="modal" data-target="#catepromotionDetailModal" data-id="@item.ID"> @item.Name</a>
                    </td>
                    
                    <td onclick="showCatePromotionDetail(@item.ID)" class="hover-emdetail" style="text-align: center;">

                        <a data-toggle="modal" data-target="#catepromotionDetailModal" data-id="@item.ID"> 
                        @(ViewBag.PromtionCountsByCatePromotion.ContainsKey(item.ID) ? ViewBag.PromtionCountsByCatePromotion[item.ID] : 0)
                        </a>
                    </td>
                    <td style="text-align: center;">
                        <a onclick="showCreatePromotionDetailView(@item.ID);">
                            <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 448 512">
                                <path fill="#000000" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z" />
                            </svg>
                        </a>
                    </td>
                    <td style="text-align: center;">
                        <a onclick="showEditCatePromotionView(@item.ID);">
                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20" height="20" viewBox="0,0,255.99603,255.99603">
                                <g fill="#000" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-size="none" style="mix-blend-mode: normal"><g transform="scale(10.66667,10.66667)"><path d="M18,2l-2.41406,2.41406l4,4l2.41406,-2.41406zM14.07617,5.92383l-11.07617,11.07617v4h4l11.07617,-11.07617z"></path></g></g>
                            </svg>
                        </a>
                    </td>
                    <td style="text-align: center;">
                        <a onclick="showModal(@item.ID);">
                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20" height="20" viewBox="0,0,255.99603,255.99603">
                                <g fill="#000" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-size="none" style="mix-blend-mode: normal"><g transform="scale(10.66667,10.66667)"><path d="M10,2l-1,1h-6v2h18v-2h-6l-1,-1zM4.36523,7l1.70313,15h11.86328l1.70313,-15z"></path></g></g>
                            </svg>
                        </a>
                    </td>
                </tr>

            }
        </tbody>
    }

</table>
@Html.PagedListPager(Model, page => Url.Action("ListCatePromotion",
    new { page, pageSize = 15 }))

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

<!-- Đặt Popper.js trước Bootstrap.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js"></script>



<script>
     $(document).ready(function () {
        // Ẩn modal khi nhấn nút "OK"
        $('#successModal').on('hidden.bs.modal', function () {
            window.location.href = "@Url.Action("ListCatePromotion", "Promotion")";
        });
    });

    function showModal(cateId) {
        $('#confirmDelete').data('cateId', cateId);
        $('#questionModal').modal('show');
    }
    $(document).on('click', '#confirmDelete', function () {
        var ID = $(this).data('cateId');
        // Gọi hàm xóa nhân viên tại đây
        deleteProduct(ID);
        // Đóng modal sau khi thực hiện xóa
        $('#questionModal').modal('hide');
    });

    function deleteProduct (cateId) {

        $.ajax({
            url: '@Url.Action("DeleteCatePromotion", "Promotion")',
            type: 'POST',
            data: {
                Id: cateId
            },
            success: function (data) {
                if (data.status === 1) {
                    $('#successModal').modal('show');
                } else {
                    // Xử lý trường hợp không thành công nếu cần
                }
            },
            error: function (xhr, status, error) {
                // Xử lý lỗi nếu cần
            }
        });
    }
    $(document).ready(function () {
        $("#addCateProBtn").click(function () {
            showCreatePromotionView();
        });
    });
    function showCreatePromotionView() {
        // Thực hiện Ajax để lấy thông tin chi tiết nhân viên từ server
        console.log("leeb")
        $.ajax({
            url: '@Url.Action("CreateCatePromotionView", "Promotion")',
            type: 'GET',
            data: {
            },
            success: function (data) {
                $('#CreateCatePromotionViewModalContent').html(data),
                $('#addCatePromotionModal').modal('show');
            },
            error: function (xhr, status, error) {
                console.log(error);
                alert('Đã có lỗi xảy ra khi thêm danh mục chương trình khuyến mãi.');
            }
        });
    }
    function showCreatePromotionDetailView(cateId) {
        // Thực hiện Ajax để lấy thông tin chi tiết nhân viên từ server
        console.log("leeb")
        $.ajax({
            url: '@Url.Action("CreatePromotionDetailView")',
            type: 'GET',
            data: {
                Id: cateId
            },
            success: function (data) {
                $('#CreatePromotionViewModalContent').html(data),
                $('#addPromotionModal').modal('show');
            },
            error: function (xhr, status, error) {
                console.log(xhr.responseText);
                alert('Đã có lỗi xảy ra khi thêm chương trình khuyến mãi.');
            }
        });
    }
    function showCreateProductDetail(productId) {
        // Thực hiện Ajax để lấy thông tin chi tiết nhân viên từ server
        console.log("leeb")
        $.ajax({
            url: '@Url.Action("AddProductDetail")',
            type: 'GET',
            data: {
                Id: productId,
            },
            success: function (data) {
                $('#ProductDeatilViewModalContent').html(data),
                $('#addProductDetailModal').modal('show');
            },
            error: function (xhr, status, error) {
                alert('Đã có lỗi xảy ra khi lấy thông tin sản phẩm.');
            }
        });
    }
    function showCatePromotionDetail(cateId) {
        // Thực hiện Ajax để lấy thông tin chi tiết nhân viên từ server
        $.ajax({
            url: '@Url.Action("DetailCatePromotionView")',
            type: 'POST',
            data: {
                Id: cateId
            },
            success: function (data) {
                console.log(data);
                $('#catepromotionDetailContent').html(data);
                $('#catepromotionDetailModal').modal('show');
            },
            error: function (xhr, status, error) {
                alert('Đã có lỗi xảy ra khi lấy thông tin chi tiết danh mục chương trình khuyến mãi.');
            }
        });
    }

    function showEditCatePromotionView(cateId) {

        $.ajax({
            url: '@Url.Action("EditCatePromotionView")',
            type: 'GET',
            data: {
                Id: cateId
            },
            success: function (data) {
                $('#EditViewModalContent').html(data),
                $('#editCatePromotionModal').modal('show');
            },
            error: function (xhr, status, error) {
                console.log(error);
                alert('Đã có lỗi xảy ra khi lấy thông tin chi tiết danh mục chương trình khuyến mãi.');
            }
        });
    }


</script>

